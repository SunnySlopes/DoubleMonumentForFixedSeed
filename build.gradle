plugins {
    id 'java'
    id 'com.github.johnrengelman.shadow' version '8.1.1'
}
group 'org.example'
version '1.1'
repositories {
    mavenCentral()
    gradlePluginPortal()
    maven {
        url "https://maven.seedfinding.com"
        }

    maven {
        url "https://maven.latticg.com"
        }

    maven {

        url "https://jitpack.io"

        }
    maven {url "https://repo.jellejurre.dev"}

}
dependencies {
    implementation('com.seedfinding:mc_math:1.171.0')
    implementation('com.seedfinding:mc_noise:1.171.1')
    implementation('com.seedfinding:mc_reversal:1.171.1')
    implementation('com.seedfinding:mc_terrain:1.171.1')
    implementation('com.seedfinding:mc_seed:1.171.2')
    implementation('com.seedfinding:mc_core:1.210.0')
    implementation('com.seedfinding:mc_biome:1.171.1')
    implementation('com.seedfinding:mc_feature:1.171.9')
    implementation('com.github.jellejurre:seed-checker:1.2.0-1.18.1'){transitive=false}
    implementation('com.github.profotoce59:VillageGenerator:main-SNAPSHOT'){transitive=false}
    implementation 'com.github.KalleStruik:noise-sampler:1.20.0'


    implementation('com.seedfinding:latticg:1.06@jar')
    implementation 'org.junit.jupiter:junit-jupiter:5.8.1'
    implementation 'org.junit.jupiter:junit-jupiter:5.8.1'
    implementation 'org.junit.jupiter:junit-jupiter:5.8.1'

}
test {
    useJUnitPlatform()
}

// 配置 Shadow JAR
shadowJar {
    archiveBaseName.set('DoubleMonument')
    archiveClassifier.set('')
    mergeServiceFiles()
}

// 创建 TestCoordsUI 的可执行 JAR
task testCoordsJar(type: com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar) {
    group = 'build'
    description = 'Creates a fat JAR for TestCoordsUI'
    archiveBaseName.set('TestCoords')
    archiveClassifier.set('')
    from sourceSets.main.output
    configurations = [project.configurations.runtimeClasspath]
    manifest {
        attributes 'Main-Class': 'project.TestCoordsUI'
    }
    mergeServiceFiles()
    transform(com.github.jengelman.gradle.plugins.shadow.transformers.Log4j2PluginsCacheFileTransformer)
    transform(com.github.jengelman.gradle.plugins.shadow.transformers.PropertiesFileTransformer) {
        paths = ['META-INF/spring.handlers', 'META-INF/spring.schemas']
        mergeStrategy = "append"
    }
}

// 创建 DoubleMonumentForFixedSeed 的可执行 JAR
task DoubleMonumentForFixedSeedJar(type: com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar) {
    group = 'build'
    description = 'Creates a fat JAR for DoubleMonumentForFixedSeed'
    archiveBaseName.set('DoubleMonumentForFixedSeed')
    archiveClassifier.set('')
    from sourceSets.main.output
    configurations = [project.configurations.runtimeClasspath]
    manifest {
        attributes 'Main-Class': 'project.Launcher'
        attributes 'Multi-Release': 'true'
    }
    mergeServiceFiles()
    transform(com.github.jengelman.gradle.plugins.shadow.transformers.Log4j2PluginsCacheFileTransformer)
    transform(com.github.jengelman.gradle.plugins.shadow.transformers.PropertiesFileTransformer) {
        paths = ['META-INF/spring.handlers', 'META-INF/spring.schemas']
        mergeStrategy = "append"
    }
    // 注意：不要排除 META-INF/versions/**，因为 Multi-Release JAR 需要这些文件
    exclude 'module-info.class'
}

// 创建所有 JAR 的任务
task buildAllJars {
    group = 'build'
    description = 'Builds all executable JARs'
    dependsOn testCoordsJar, DoubleMonumentForFixedSeedJar
}